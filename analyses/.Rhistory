setwd("~/Documents/git/ospree/analyses")
## to start
rm(list=ls())
options(stringsAsFactors=FALSE)
## load packages
library(tidyr)
library(dplyr)
library(geosphere)
library(lubridate)
library(ggplot2)
############################################
############# Phenofit Stuff ###############
############################################
fs.present<-read.csv("output/phenofit_projections/Fagus_sylvatica_1981_2000_daylength.csv", header=TRUE)
fs.pres<-read.csv("output/phenofit_projections/Fagus_sylvatica_1981_2000.csv", header=TRUE)
fs.proj<-read.csv("output/phenofit_projections/Fagus_sylvatica_A1Fi_2081_2100_daylength.csv", header=TRUE)
fs.proj.pres<-read.csv("output/phenofit_projections/Fagus_sylvatica_A1Fi_2081_2100.csv", header=TRUE)
fs.present<-fs.present%>%dplyr::rename(mleaf=MeanDateLeaf)
fs.proj<-fs.proj%>%dplyr::rename(proj.lodoy=lodoy)%>%dplyr::rename(proj.photo=daylength)
fs<-full_join(fs.present, fs.proj)
fs.pres<-subset(fs.pres, pres==1)
fs.pres$avg<-ave(fs.pres$Lat)
fs.proj.pres<-subset(fs.proj.pres, pres==1)
fs.proj.pres$avg<-ave(fs.proj.pres$Lat)
shift<-unique(fs.proj.pres$avg) - unique(fs.pres$avg)
fs.pres$geo.shift<-fs.pres$Lat + shift
fs.geo<-full_join(fs, fs.pres)
fs.geo$date<-as.Date(fs.geo$lodoy, origin = "2000-01-01")
fs.geo$photo.shift<-fs.geo$daylength-fs.geo$proj.photo
#fs.geo$photo.shift<-NA
#for(i in c(1:nrow(fs.geo))){
#  fs.geo$photo.shift[i] <- daylength(fs.geo$geo.shift[i], fs.geo$date[i])
#}
fs.geo<-fs.geo[!is.na(fs.geo$photo.shift),]
fs.geo<-fs.geo[!is.na(fs.geo$geo.shift),]
fs.geo$phen.shift<-fs.geo$lodoy-fs.geo$proj.lodoy ## first pheno.shift
fs.geo$type<-"projected"
View(fs.geo)
